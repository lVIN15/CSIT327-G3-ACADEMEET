{% extends "settings_base.html" %}
{% load static %}

{% block title %}General Settings - Academeet{% endblock %}

{% block settings_content %}
    <h3>General System Settings</h3>

    {% if messages %}
        {% for message in messages %}
            <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <div class="settings-card" style="margin-top: 30px;">
        <h4>User Role Management</h4>
        <table>
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Current Role</th>
                    <th>Assign New Role</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for target_user in all_users %}
                <tr>
                    <td>{{ target_user.username }}</td>
                    <td>{{ target_user.userprofile.get_role_display }}</td>
                    <td>
                        <form method="post" action="{% url 'general_settings' %}" style="display: inline-flex; gap: 5px;">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="change_role">
                            <input type="hidden" name="target_user_id" value="{{ target_user.id }}">
                            
                            <select name="new_role" required>
                                <option value="ADMIN" {% if target_user.userprofile.role == 'ADMIN' %}selected{% endif %}>Admin</option>
                                <option value="TEACHER" {% if target_user.userprofile.role == 'TEACHER' %}selected{% endif %}>Teacher</option>
                                <option value="STUDENT" {% if target_user.userprofile.role == 'STUDENT' %}selected{% endif %}>Student</option>
                            </select>
                            
                            <button type="submit" class="btn-assign">Assign</button>
                        </form>
                      <td>
                    <a href="{% url 'view_user_profile' target_user.id %}" class="btn-view-profile">View</a>
                    </tr>
                    {% empty %}
                <tr><td colspan="4">No other users found.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    {% endblock %}